# Enhanced ZSH Configuration for Claude Code Development Environment
# =================================================================

# Load colors and basic ZSH features
autoload -U colors && colors
autoload -U compinit && compinit

# Enhanced completion system with beautiful colors
zstyle ':completion:*' menu select
zstyle ':completion:*' matcher-list 'm:{a-zA-Z}={A-Za-z}'
zstyle ':completion:*' list-colors ""
zstyle ':completion:*' special-dirs true
zstyle ':completion:*' squeeze-slashes true
zstyle ':completion:*:*:*:*:descriptions' format '%F{green}-- %d --%f'
zstyle ':completion:*:*:*:*:corrections' format '%F{yellow}\!- %d (errors: %e) -\!%f'
zstyle ':completion:*:messages' format ' %F{purple} -- %d --%f'
zstyle ':completion:*:warnings' format ' %F{red}-- no matches found --%f'
zstyle ':completion:*:default' list-prompt '%S%M matches%s'
zstyle ':completion:*' format ' %F{yellow}-- %d --%f'
zstyle ':completion:*' group-name ''

# History configuration
export HISTFILE=~/.local/share/zsh/history
export HISTSIZE=10000
export SAVEHIST=10000
setopt HIST_IGNORE_DUPS
setopt HIST_FIND_NO_DUPS
setopt HIST_REDUCE_BLANKS
setopt SHARE_HISTORY
setopt APPEND_HISTORY
setopt INC_APPEND_HISTORY

# Better directory navigation
setopt AUTO_CD              # Type directory name to cd
setopt AUTO_PUSHD           # Make cd push old directory onto directory stack
setopt PUSHD_IGNORE_DUPS    # Don't push duplicate directories
setopt PUSHD_SILENT         # Don't print directory stack after pushd/popd

# Enhanced prompt with git info and beautiful styling
autoload -Uz vcs_info
precmd() { 
    vcs_info
    # Add a subtle separator line for visual clarity
    print -P "%F{240}%{────────────────────────────────────────────────────────────────────────────────%}%f"
}

# Configure git info display
zstyle ':vcs_info:*' enable git
zstyle ':vcs_info:git:*' formats ' %F{magenta}⎇ %b%f'
zstyle ':vcs_info:git:*' actionformats ' %F{magenta}⎇ %b%f %F{red}| %a%f'
setopt PROMPT_SUBST

# Beautiful multi-line prompt with icons and colors
PROMPT='
%F{39}╭─%f %F{114}⚡%f %F{39}claude-dev%f %F{240}│%f %F{220}📁 %~%f
%F{39}╰─%f %F{46}❯%f '

# Right-side prompt with time
RPROMPT='%F{240}%D{%H:%M:%S}%f'

# Path configuration
export PATH="/Users/tthew/.npm-global/bin:/Users/tthew/.local/bin:/Users/tthew/.nvm/versions/node/v22.11.0/bin:/opt/homebrew/bin:/opt/homebrew/sbin:/usr/local/bin:/System/Cryptexes/App/usr/bin:/usr/bin:/bin:/usr/sbin:/sbin:/var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/local/bin:/var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/bin:/var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/appleinternal/bin:/Library/Apple/usr/bin:/Applications/Wireshark.app/Contents/MacOS:/Applications/Little Snitch.app/Contents/Components:/Users/tthew/.nvm/versions/node/v22.11.0/bin:/Users/tthew/.local/bin:/Users/tthew/.cargo/bin:/opt/homebrew/bin:/usr/local/bin:/System/Cryptexes/App/usr/bin:/usr/bin:/bin:/usr/sbin:/sbin:/var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/local/bin:/var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/bin:/var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/appleinternal/bin:/Library/Apple/usr/bin:/Applications/Wireshark.app/Contents/MacOS:/Applications/Little Snitch.app/Contents/Components:/opt/homebrew/bin:/opt/homebrew/sbin:/Users/tthew/.nvm/versions/node/v22.11.0/bin:/Users/tthew/.local/bin:/Users/tthew/.cargo/bin:/opt/homebrew/bin:/opt/homebrew/bin:/opt/homebrew/sbin:/Users/tthew/.nvm/versions/node/v22.11.0/bin:/Users/tthew/.local/bin:/usr/local/bin:/System/Cryptexes/App/usr/bin:/usr/bin:/bin:/usr/sbin:/sbin:/var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/local/bin:/var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/bin:/var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/appleinternal/bin:/Library/Apple/usr/bin:/Applications/Little Snitch.app/Contents/Components:/Applications/Wireshark.app/Contents/MacOS:/Users/tthew/.nvm/versions/node/v22.11.0/bin:/Users/tthew/.cargo/bin:"/opt/homebrew/bin:$PATH""

# Claude Code aliases with beautiful feedback
alias claude='echo "🤖 Launching Claude Code..." && claude --dangerously-skip-permissions --model sonnet'
alias claude-dev='echo "🤖 Launching Claude Code in project..." && claude --dangerously-skip-permissions --model sonnet --project-dir /workspace'

# Development aliases with visual feedback
alias dev-start='echo "🚀 Starting development server..." && npm run dev'
alias dev-test='echo "🧪 Running tests..." && npm test'
alias dev-build='echo "🏗️ Building project..." && npm run build'
alias dev-lint='echo "🔍 Linting code..." && npm run lint'
alias dev-typecheck='echo "📝 Type checking..." && npm run typecheck'

# Project shortcuts with visual feedback
alias goto-workspace='echo "🏠 Navigating to workspace..." && cd /workspace'
alias check='echo "✅ Running lint and typecheck..." && npm run lint && npm run typecheck'
alias logs='echo "📋 Viewing development logs..." && tail -f /workspace/debug.log'
alias serve='echo "🚀 Starting development server..." && npm run dev'

# Enhanced directory listing with colors
alias ls='ls --color=auto'
alias ll='ls -alF --color=auto'
alias la='ls -A --color=auto'
alias l='ls -CF --color=auto'
alias lt='ls -altr --color=auto'  # List by time
alias lh='ls -alh --color=auto'   # Human readable sizes

# Git shortcuts with beautiful feedback and emojis
alias ga='echo "📦 Adding files to git..." && git add'
alias gc='echo "💾 Committing changes..." && git commit'
alias gp='echo "🚀 Pushing to remote..." && git push'
alias gpu='echo "⬇️ Pulling from remote..." && git pull'
alias gco='echo "🔀 Switching branch..." && git checkout'
alias gb='echo "🌿 Listing branches..." && git branch --color=always'
alias gst='echo "📊 Git status..." && git status'
alias gd='git diff'
alias gs='git status'
alias gl='git log --oneline'

# NPM shortcuts with beautiful feedback
alias ni='echo "📦 Installing npm packages..." && npm install'
alias nr='echo "🏃 Running npm script..." && npm run'
alias ns='echo "▶️ Starting npm..." && npm start'
alias nt='echo "🧪 Running npm tests..." && npm test'

# Quick navigation aliases with visual feedback
alias ..='echo "📁 Going up..." && cd ..'
alias ...='echo "📁 Going up 2 levels..." && cd ../..'
alias ....='echo "📁 Going up 3 levels..." && cd ../../..'

# Enhanced tree command (exclude node_modules)
alias tree='tree -I node_modules --dirsfirst -C'

# CLI tool aliases
alias python='python3'
alias pip='python3 -m pip'
alias uvx='uv tool run'

# Firewall and whitelist management aliases
alias whitelist='manage-whitelist.sh'
alias firewall-status='iptables -L -n'
alias log-cleanup='log-cleanup.sh'
alias disk-usage='log-cleanup.sh --report'

# Colorized tools
alias grep='grep --color=auto'
alias fgrep='fgrep --color=auto'
alias egrep='egrep --color=auto'
alias diff='diff --color=auto'

# Help system
alias aliases='alias | grep -E "^(claude|dev-|goto|help|welcome)" | sort'
alias show-aliases='alias | sort'

# Show welcome message automatically for SSH sessions (once per session)
if [[ -n "192.168.2.210 60024 192.168.2.220 22" || -n "192.168.2.210 60024 22" ]]; then
    if [[ ! -f /tmp/.$USER-welcome-shown ]]; then
        source ~/.welcome.sh
        touch /tmp/.tthew-welcome-shown
    fi
fi

# Navigate to workspace on login
cd /workspace 2>/dev/null || true

# Help function that works reliably


# Simple help and welcome functions
help() { source ~/.welcome.sh; }
welcome() { source ~/.welcome.sh; }


# Simple function to show all whitelisted domains
show-whitelist() {
    echo "📋 All whitelisted domains:"
    grep "^server=" /etc/whitelist-domains.conf | sed "s|server=/||g" | sed "s|/.*||g" | sort -u | nl -w3 -s". "
    echo ""
    local total=$(grep "^server=" /etc/whitelist-domains.conf | sed "s|server=/||g" | sed "s|/.*||g" | sort -u | wc -l)
    echo "📊 Total domains: $total"
}
alias whitelist="/usr/local/bin/manage-whitelist.sh"
