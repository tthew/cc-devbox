# Log rotation configuration for firewall and security logs
# Prevents disk space exhaustion from security logging

# Firewall logs
/var/log/firewall/*.log {
    daily
    rotate 7
    compress
    delaycompress
    missingok
    notifempty
    create 644 root root
    maxsize 10M
    
    # Clean up after rotation
    postrotate
        # Signal syslog to reopen log files if needed
        /bin/kill -HUP `cat /var/run/rsyslogd.pid 2> /dev/null` 2> /dev/null || true
    endscript
}

# dnsmasq logs
/var/log/dnsmasq/*.log {
    daily
    rotate 3
    compress
    delaycompress
    missingok
    notifempty
    create 644 root root
    maxsize 20M
    
    # Restart dnsmasq to reopen log files
    postrotate
        /bin/kill -USR1 `cat /var/run/dnsmasq.pid 2> /dev/null` 2> /dev/null || true
    endscript
}

# Application logs in workspace
/workspace/logs/*.log {
    daily
    rotate 5
    compress
    delaycompress
    missingok
    notifempty
    create 644 dev dev
    maxsize 50M
    
    # No restart needed for application logs
    postrotate
        # Optional: trigger application log reload
        # /bin/kill -USR1 `cat /workspace/logs/app.pid 2> /dev/null` 2> /dev/null || true
    endscript
}

# Kernel/system logs (if they grow large due to firewall logging)
/var/log/kern.log {
    daily
    rotate 3
    compress
    delaycompress
    missingok
    notifempty
    create 644 root root
    maxsize 30M
    
    postrotate
        /bin/kill -HUP `cat /var/run/rsyslogd.pid 2> /dev/null` 2> /dev/null || true
    endscript
}

# Messages log (catches iptables LOG target output)
/var/log/messages {
    daily
    rotate 3
    compress
    delaycompress
    missingok
    notifempty
    create 644 root root
    maxsize 30M
    
    postrotate
        /bin/kill -HUP `cat /var/run/rsyslogd.pid 2> /dev/null` 2> /dev/null || true
    endscript
}