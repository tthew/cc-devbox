# dnsmasq configuration for domain whitelist
# Based on Claude Code security best practices

# Basic configuration
port=53
domain-needed
bogus-priv
no-resolv
no-poll

# Logging configuration with size management
log-queries
log-facility=/var/log/dnsmasq/dnsmasq.log
log-async=50

# Performance optimizations
cache-size=1000
neg-ttl=60
max-ttl=3600

# Security settings
stop-dns-rebind
rebind-localhost-ok

# Use upstream DNS servers for whitelisted domains
server=8.8.8.8
server=8.8.4.4

# Read whitelist domains from separate file
conf-file=/etc/whitelist-domains.conf

# Bind to all interfaces
bind-interfaces
interface=lo
interface=eth0

# Default behavior: Block all domains not in whitelist
# This is achieved by not forwarding queries for non-whitelisted domains
local-ttl=60

# Configure to answer NXDOMAIN for non-whitelisted domains
# All non-whitelisted domains will be blocked
address=/#/127.0.0.1